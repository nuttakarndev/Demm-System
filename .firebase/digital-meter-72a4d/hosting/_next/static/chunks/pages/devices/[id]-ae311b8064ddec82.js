(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[403],{6306:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/devices/[id]",function(){return a(3776)}])},6784:function(e,t,a){"use strict";a.d(t,{Z:function(){return g}});var r=a(1844),l=a(1395),s=a(1843),n=a(1163),o=a(9403),i=a(5784),c=a(9473);function d(){let e=(0,c.I0)(),t=(0,n.useRouter)(),{user:a,loading:d}=(0,c.v9)(e=>e.auth),{current:g,loading:m}=(0,c.v9)(e=>e.device),p=()=>e((0,l.UX)());return(0,i.useEffect)(()=>{e((0,s.TE)())},[e]),(0,r.jsx)("aside",{className:"sidebar text-white",children:!m&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"info",onClick:()=>t.push("/"),children:[(0,r.jsx)("div",{className:"label",children:"SignIn With:"}),(0,r.jsx)("div",{className:"email",children:null==a?void 0:a.email})]}),(0,r.jsx)("ul",{className:"devices mt-3",children:g.map(e=>(0,r.jsx)(u,{device:e,router:t},e))}),(0,r.jsx)(o.z,{className:"p-button-danger w-full mt-auto",label:"Sign out",loading:d,icon:"pi pi-sign-out",onClick:p})]})})}function u(e){let{device:t,router:a}=e;return(0,r.jsx)("div",{className:"device",onClick:()=>a.push("/devices/".concat(t)),children:t},t)}function g(e){let{children:t}=e;return(0,r.jsxs)("main",{className:"template",children:[(0,r.jsx)(d,{}),(0,r.jsx)("div",{className:"p-3 overflow-y-auto",children:t})]})}},7817:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var r=a(1844),l=a(1163),s=a(5784),n=a(9473);function o(e){let{children:t}=e,a=(0,l.useRouter)(),{user:o}=(0,n.v9)(e=>e.auth);return(0,s.useEffect)(()=>{o||a.push("/login")},[a,o]),(0,r.jsx)(r.Fragment,{children:o?t:null})}},3776:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var r=a(1844),l=a(6784),s=a(1163),n=a(3741),o=a(8751),i=a(5784),c=a(2896),d=a(9403),u=a(8650),g=a(7817),m=a(9473),p=a(6148),h=a(1843),x=a(6486);class v{static getDeviceLabel(e){let t=e.map(e=>e.timestamp.toDate().getDate());return Array.from(new Set(t.sort((e,t)=>e-t)))}static getVoltage(e,t){let a=[],r={};return e.forEach(e=>{let l=e.timestamp.toDate();r[l.getDate()]?r[l.getDate()]+=e[t]:r[l.getDate()]=e[t],a.push(l.getDate())}),{label:Array.from(new Set(a)),data:Object.keys(r).map(e=>{let t=a.filter(t=>t==e).length;return r[e]/t})}}static filter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return(0,x.chain)(e).filter(e=>{let{timestamp:r}=e,l=r.toDate();return t.setHours(0,0,0),a.setHours(23,59,59),(0,x.gte)(l,t)&&(0,x.lte)(l,a)}).value()}static getAvg(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(0===e.length)return 0;let a=e.filter(e=>e[t]).map(e=>e[t]).reduce((e,t)=>e+t,0);return String((a/e.length).toFixed(2))}}var f=a(2175),j=a(6310),y=a(120);class b{static getCurrent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dd MMMM yyyy";return y.ou.now().toFormat(e)}}let D=()=>{let e=(0,s.useRouter)(),t=(0,m.I0)(),{id:a}=e.query,[x,D]=(0,i.useState)(0),{records:w}=(0,m.v9)(e=>e.device),[N,P]=(0,i.useState)([]),{voltageData:k,voltageOption:V}=function(e){let[t,a]=(0,i.useState)({}),[r,l]=(0,i.useState)({});return(0,i.useEffect)(()=>{let t=getComputedStyle(document.documentElement),r=t.getPropertyValue("--text-color"),s=t.getPropertyValue("--text-color-secondary"),n=t.getPropertyValue("--surface-border"),o={labels:[0,...v.getVoltage(e,"voltage").label],datasets:[{label:"Voltage",data:[0,...v.getVoltage(e,"voltage").data],fill:!1,borderColor:t.getPropertyValue("--blue-500"),tension:.4}]};a(o),l({maintainAspectRatio:!1,aspectRatio:.6,plugins:{legend:{labels:{color:r},position:"bottom"}},scales:{x:{ticks:{color:s},grid:{color:n}},y:{ticks:{color:s},grid:{color:n}}}})},[e]),{voltageData:t,voltageOption:r}}(N),{currentData:C,currentOption:S}=function(e){let[t,a]=(0,i.useState)({}),[r,l]=(0,i.useState)({});return(0,i.useEffect)(()=>{let t=getComputedStyle(document.documentElement),r=t.getPropertyValue("--text-color"),s=t.getPropertyValue("--text-color-secondary"),n=t.getPropertyValue("--surface-border"),o={labels:[0,...v.getVoltage(e,"current").label],datasets:[{label:"Current",data:[0,...v.getVoltage(e,"current").data],fill:!1,borderColor:t.getPropertyValue("--yellow-500"),tension:.4}]};a(o),l({maintainAspectRatio:!1,aspectRatio:.6,plugins:{legend:{labels:{color:r},position:"bottom"}},scales:{x:{ticks:{color:s},grid:{color:n}},y:{ticks:{color:s},grid:{color:n}}}})},[e]),{currentData:t,currentOption:r}}(N),{powerData:E,powerOption:R}=function(e){let[t,a]=(0,i.useState)({}),[r,l]=(0,i.useState)({});return(0,i.useEffect)(()=>{let t=getComputedStyle(document.documentElement),r=t.getPropertyValue("--text-color"),s=t.getPropertyValue("--text-color-secondary"),n=t.getPropertyValue("--surface-border"),o={labels:[0,...v.getVoltage(e,"power").label],datasets:[{label:"Power",data:[0,...v.getVoltage(e,"power").data],fill:!1,borderColor:t.getPropertyValue("--pink-500"),tension:.4}]};a(o),l({maintainAspectRatio:!1,aspectRatio:.6,plugins:{legend:{labels:{color:r},position:"bottom"}},scales:{x:{ticks:{color:s},grid:{color:n}},y:{ticks:{color:s},grid:{color:n}}}})},[e]),{powerData:t,powerOption:r}}(N),_=(0,f.TA)({initialValues:{startDate:null,endDate:null},validationSchema:(0,j.Ry)().shape({startDate:(0,j.hT)().nullable().required("field required!").typeError("field required!"),endDate:(0,j.hT)().nullable().required("field required!").typeError("field required!")}),onSubmit:e=>{P(v.filter(w,e.startDate,e.endDate))}});return(0,i.useEffect)(()=>{a&&t((0,h.Q6)(a))},[t,a]),(0,i.useEffect)(()=>{_.values.startDate||_.values.endDate||P(v.filter(w,new Date,new Date))},[w]),(0,r.jsx)(g.Z,{children:(0,r.jsxs)(l.Z,{children:[(0,r.jsxs)("section",{className:"flex align-items-center justify-content-between flex-wrap gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{children:["Device: ",a]}),(0,r.jsxs)("span",{children:["DateTime (Today): ",b.getCurrent()]})]}),(0,r.jsxs)("form",{onSubmit:_.handleSubmit,onReset:_.handleReset,className:"flex align-items-center gap-3",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(o.f,{showIcon:!0,placeholder:"Start Date",className:_.errors.startDate&&"p-invalid",value:_.values.startDate,name:"startDate",dateFormat:"dd/mm/yy",onChange:_.handleChange,maxDate:_.values.endDate}),_.errors.startDate&&(0,r.jsx)("small",{className:"text-red-500 absolute",style:{width:"100%",bottom:"-20px",left:"5px"},children:_.errors.startDate})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(o.f,{showIcon:!0,placeholder:"End Date",className:_.errors.endDate&&"p-invalid",value:_.values.endDate,name:"endDate",dateFormat:"dd/mm/yy",onChange:_.handleChange,minDate:_.values.startDate}),_.errors.endDate&&(0,r.jsx)("small",{className:"text-red-500 absolute",style:{width:"100%",bottom:"-20px",left:"5px"},children:_.errors.endDate})]}),(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)(d.z,{icon:"pi pi-search",type:"submit"}),(0,r.jsx)(d.z,{icon:"pi pi-refresh",type:"reset",className:"p-button-secondary"})]})]})]}),(0,r.jsx)("section",{children:(0,r.jsxs)("div",{className:"grid",children:[(0,r.jsxs)("div",{className:"col-4",children:[(0,r.jsx)("h4",{children:"Voltage (avg)"}),(0,r.jsx)("div",{children:v.getAvg(N,"voltage")})]}),(0,r.jsxs)("div",{className:"col-4",children:[(0,r.jsx)("h4",{children:"Current (avg)"}),(0,r.jsx)("div",{children:v.getAvg(N,"current")})]}),(0,r.jsxs)("div",{className:"col-4",children:[(0,r.jsx)("h4",{children:"Power (avg)"}),(0,r.jsx)("div",{children:v.getAvg(N,"power")})]})]})}),(0,r.jsxs)("section",{children:[(0,r.jsx)(p.d,{model:[{label:"Voltage"},{label:"Current"},{label:"Power"}],onTabChange:e=>D(e.index),activeIndex:x}),(0,r.jsx)("div",{className:"grid mt-3",children:(0,r.jsxs)("div",{className:"col-12",children:[0===x&&(0,r.jsx)(n.k,{type:"line",data:k,options:V}),1===x&&(0,r.jsx)(n.k,{type:"line",data:C,options:S}),2===x&&(0,r.jsx)(n.k,{type:"line",data:E,options:R})]})})]}),(0,r.jsx)("section",{children:(0,r.jsxs)(c.w,{responsiveLayout:"stack",value:N,paginator:!0,rowsPerPageOptions:[10,25,50],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rows:10,children:[(0,r.jsx)(u.s,{field:"timestamp",header:"Timestamp",body:e=>(0,r.jsx)("span",{children:y.ou.fromJSDate(e.timestamp.toDate()).toFormat("dd/MM/yyyy hh:mm")})}),(0,r.jsx)(u.s,{field:"voltage",header:"Voltage"}),(0,r.jsx)(u.s,{field:"current",header:"Current"}),(0,r.jsx)(u.s,{field:"power",header:"Power",align:"center",body:e=>e.power||"-"})]})})]})})};var w=D}},function(e){e.O(0,[257,518,127,145,888,179],function(){return e(e.s=6306)}),_N_E=e.O()}]);